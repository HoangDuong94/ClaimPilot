<core:FragmentDefinition
    xmlns="sap.m"
    xmlns:core="sap.ui.core"
    xmlns:l="sap.ui.layout"
    xmlns:html="http://www.w3.org/1999/xhtml">

    <VBox width="100%" height="100%" class="cpChatSidePanel" renderType="Bare">
        <Toolbar>
            <Title text="PureAI"/>
            <ToolbarSpacer/>
            <Button
                icon="sap-icon://stop"
                type="Transparent"
                tooltip="Streaming stoppen"
                visible="{chat>/isStreaming}"
                press="onStopStreaming"/>
        </Toolbar>

        <!-- Suggestions (visible when not streaming and initial state) -->
        <HBox
            width="100%"
            visible="{chat>/showSuggestions}"
            class="cp-suggestions"
            wrap="Wrap"
            items="{chat>/suggestions}">
            <items>
                <Button text="{chat>text}" type="Default" press="onSuggestionPress" class="cp-suggestion-btn"/>
            </items>
        </HBox>

        <ScrollContainer id="chatHistoryScrollContainerInSidePanel" width="100%" height="100%" vertical="true">
            <VBox width="100%" class="cp-chat-container">
                <List
                    id="chatHistoryList"
                    items="{chat>/chatHistory}"
                    width="100%"
                    inset="false"
                    showSeparators="None">
                    <CustomListItem>
                        <HBox width="100%" justifyContent="{= ${chat>type} === 'user' ? 'End' : 'Start'}" alignItems="Start" class="cp-bubble-wrapper">
                            <VBox>
                                <HBox class="cp-meta" alignItems="Center" renderType="Bare">
                                    <core:Icon src="{= ${chat>type} === 'user' ? 'sap-icon://person-placeholder' : 'sap-icon://machine'}" class="cp-avatar"/>
                                    <Text text="{= ${chat>type} === 'user' ? 'Du' : 'PureAI'}" class="cp-chip"/>
                                </HBox>
                                <HBox alignItems="Start" renderType="Bare">
                                    <FormattedText
                                        htmlText="{chat>text}"
                                        class="{= ${chat>type} === 'user' ? 'cp-bubble cp-user' : 'cp-bubble cp-assistant'}"/>
                                    <Button
                                        icon="sap-icon://copy"
                                        type="Transparent"
                                        tooltip="Text kopieren"
                                        visible="{= ${chat>type} !== 'user' }"
                                        press="onCopyMessage"
                                        class="cp-bubble-actions"/>
                                </HBox>
                            </VBox>
                        </HBox>
                    </CustomListItem>
                </List>
            </VBox>
        </ScrollContainer>

        <HBox class="modernInputRow" alignItems="End">
            <VBox width="100%">
                <TextArea
                    id="chatInputField"
                    value="{chat>/userInput}"
                    placeholder="Nachricht an PureAI..."
                    rows="3"
                    width="100%"
                    growing="true"
                    growingMaxLines="6"/>
            </VBox>
            <Button
                id="sendButton"
                icon="sap-icon://paper-plane"
                type="Emphasized"
                enabled="{= !${chat>/isStreaming} }"
                press="onSendChatMessageInSidePanel"/>
        </HBox>
    </VBox>

</core:FragmentDefinition>
